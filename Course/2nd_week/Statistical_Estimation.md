# 데이터분석 스터디 - 1주차

---

---

# 1주차 : 통계적 추정

- **통계적 추론의 목적** : 표본(Sample)의 정보로부터 모집단(Population)에 대한 정보를 얻는 것
    - 모수(Population parameter) : 모집단의 특성을 나타내는 상수들
    - 통계량(Statistics) : 표본의 특성을 나타내는 상수들

<aside>
💡 **`Tip!` 왜 통계적 추정 방법이 필요할까?**

---

> 제후는 어느 날 대한민국의 모든 가구(모집단)의 소득 수준(모수)을 구하고 싶어졌다.

하지만, 모든 가구의 소득을 조사하기에는 현실적(자원의 한계) 으로 어렵다.

제후는 전국 각지의 1000가구(표본집단) 정도의 소득을 조사한 데이터(표본)를 가지고 있지만, 사정상 추가적인 데이터를 얻기는 어려운 상황이다.

따라서, 지금 가지고 있는 데이터를 사용해서 대한민국의 모든 가구의 소득 수준을 추정해야만 한다.

과연 어떻게 해야할까?
> 
</aside>

## 1. 통계량

---

### 1.1 모수

- 모집단의 특성을 나타내는 수치
- 모평균, 모비율, 모분산, 모표준편차

### 1.2 통계량

- 표본평균, 표본비율, 표본분산, 표본표준편차
- 모집단의 모수를 추정(Estimation)하거나 가설 검정(Test of hypothesis)하기 위해 사용되는 값
    - 통계량들은 각각 특정한 확률분포를 따르기 때문에 이를 활용함

## 2 . 대표적인 확률분포

---

- 대표적으로 추정과 가설 검정에 많이 활용되는 확률분포 : **Z-분포, 카이제곱분포, t-분포, F-분포**

### 2.1 Z-분포

---

- `정규분포(Normal distribution)` : 평균이 $\mu$, 분산이 $\sigma^2$인 연속형 확률분포의 일종
    - 주로 수집된 자료의 분포를 근사하는 데에 자주 사용됨(by 중심극한정리)
    - `중심극한정리` : 독립적인 확률변수들의 평균은 정규분포에 가까워지는 성질($n ≥ 30$)
- $X \sim N(\mu, \sigma^2)$ → 확률변수 $X$가 모수 $\mu, \sigma^2$를 갖는 정규분포를 따름

![image.png](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%E1%84%83%E1%85%B5%20-%201%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e90dcbbf03944151b1c04bbdf309b603/image.png)

- `표준정규분포(Standard normal distribution, Z-분포)` : 정규분포를 따르는 확률변수 $X$에 대해 표준화 한 확률변수 $Z$의 분포
    - 표준화 : $z=\frac{x-\mu}{\sigma}$
- $Z = (X-\mu)/\sigma$ → $Z \sim N(0, 1)$
    - `확률밀도함수` : $f(x)=\frac{1}{\sqrt{2\pi}}e^{-\frac{z^2}{2}}, -\infty < x < \infty$
    - `기댓값` : $E(X) = \mu$
    - `분산` : $Var(X) = \sigma^2$

```python
# 정규분포
# 확률변수 X가 정규분포 N(30, 64)를 따를 때, 26 ~ 46 구간의 확률은?
from scipy.stats import norm    # 표준정규분포
import numpy as np

E = 30    # 평균
V = 64    # 분산
S = np.sqrt(V)    # 표준편차

x1 = 26
x2 = 46
zstat1 = (x1 - E) / S    # 표준화
zstat2 = (x2 - E) / S    # 표준화
cdf = norm.cdf(zstat2) - norm.cdf(zstat1)

print(f"구간의 확률은 {cdf:.3f}")
# 구간 내 누적확률은 0.669
```

```python
# 표준정규분포
# 확률변수 X가 표준정규분포를 따를 때 -1.96 ~ 1.96 구간의 확률은?
from scipy.stats import norm    # 표준정규분포
import numpy as np

E = 0    # 평균
V = 1    # 분산
S = np.sqrt(V)    # 표준편차

zstat1 = -1.96
zstat2 = 1.96
cdf = norm.cdf(zstat2) - norm.cdf(zstat1)

print(f"구간의 확률은 {cdf:.3f}")
# 구간 내 누적확률은 0.950
```

<aside>
✅

**`Check!` 확률밀도함수(pdf), 누적분포함수(cdf), 기댓값, 분산**

---

- `확률밀도함수`
    - 연속형 확률변수의 확률 분포를 나타내는 함수
    - 확률변수가 특정 값 근처에서 가지는 확률을 나타내는 밀도 함수
- `누적분포함수`
    - 확률변수가 특정 값 이하의 값을 가질 확률을 나타내는 함수
- `기댓값`
    - 확률변수의 평균값
    - 확률변수가 어떤 값을 취할 것으로 기대되는지를 나타내는 경향
- `분산`
    - 확률변수의 값들이 기댓값 주변에서 얼마나 퍼져 있는지를 나타내는 척도
</aside>

<aside>
💡 **`Tip!` 왜 표준화를 진행할까?**

---

1. 다양한 정규분포를 공통된 기준으로 비교하거나 분석하기 용이함
    - 다양한 데이터가 비교 가능하도록 평균 0, 표준편차 1인 분포로 통일
    - 서로 다른 단위나 스케일을 가진 변수들을 동일한 척도로 맞추기 위함
    - ex) 시험점수 - 키 : 비교할 수 없는 대상들을 표준화를 통해 비교
2. 표준정규분포를 통해 특정 확률 값이나 임계값을 찾기 쉽고, 계산이 단순해짐
3. 머신러닝에서 변수의 스케일이 다를 경우 알고리즘 성능에 악영향을 주기 때문
</aside>

### 2.2 카이제곱분포

---

![image.png](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%E1%84%83%E1%85%B5%20-%201%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e90dcbbf03944151b1c04bbdf309b603/image%201.png)

- 감마분포의 특수한 경우로써 $\alpha=n/2, \beta=2$인 경우를 자유도 $n$인 카이제곱분포라고 정의
    - 모집단이 정규분포인 대표본에서 모분산 $\sigma^2$을 추정/검정하거나, 비모수 검정 중에서 범주형 변수들에 대한 적합도 검정, 독립성 검정, 동질성 검정에 사용됨
        - 주로 `두 집단 간의 동질성 검정`에 활용
- $X \sim \chi^2_{(n)}$ → 확률변수 $X$가 자유도 $n$인 카이제곱분포를 따름
    - `확률밀도함수` : $\frac{1}{\Gamma(\frac{n}{2})^{2^\frac{n}{2}}}^{x^{\frac{n}{2}-1}e^{-\frac{x}{2}}}, x > 0, n > 0$
    - `기댓값` : $E(X) = n$
    - `분산` : $~~Var(X) = 2n~~$

<aside>
✅

**`Check!` 감마분포**

---

- 지수분포의 확장된 개념으로, $\alpha$번의 사건이 발생할 때까지의 대기시간을 나타내는 분포
- $X \sim Gamma(\alpha, \beta)$
- $\alpha$ : 형상 모수(Shape Parameter)로, 감마분포의 형태를 결정하는 매개변수
    - 발생하는 사건의 횟수와 관련있는 변수
- $\beta$ : 척도 모수(Scale Parameter)로, 감마분포의 스케일을 결정하는 매개변수
    - 단위시간당 발생하는 사건의 속도와 관련있는 변수
</aside>

<aside>
✅ **`Check!` 적합도 검정, 독립성 검정, 동질성 검정**

---

- `적합도 검정(Goodness of fit test)`
    - 주어진 데이터가 특정 분포(정규분포, 이항분포 등)를 잘 따르는지 검정
    - ex) 동전 던지기 - 베르누이 분포
- `독립성 검정(Test of independence)`
    - 두 범주형 변수 간의 독립성을 평가하는데 사용되는 검정
    - 즉, 한 변수 값이 다른 변수의 값에 영향을 미치는지 여부를 검정
    - ex) 흡연 여부(흡연자/비흡연자) - 성별(남성/여성)
- `동질성 검정(Test of homogeneity)`
    - 여러 집단이 동일한 분포를 따르는지 평가하기 위한 검정
    - ex) 세 개의 다른 도시에서 조사한 흡연자 비율
</aside>

<aside>
✅ **`Check!` 자유도(Degree of freedom)**

---

- 통계적 추정을 할 때 표본자료 중 모집단에 대한 정보를 주는 독립적인 자료의 수
    - 즉, 데이터 내에서 자유롭게 변할 수 있는 값의 개수
    - 자유도 = 표본의 개수 - 제약 조건의 수
    - ex) $x_1, x_2, x_3, x_4, x_5$가 있을 때, 표본 평균을 계산한 후 표본 평균을 사용해 계산
        - $\bar{x}=\frac{x_1+x_2+x_3+x_4+x_5}{5}$ → $x_5$는 $x_1, x_2, x_3, x_4$와 평균에 의해 결정
</aside>

### 2.3 t-분포

---

- `t-분포(t-distribution)` : 표본 평균을 표본 분산으로 표준화한 값이 따르는 확률분포
    - $T=\frac{Z}{\sqrt{V/v}} \sim t(k)$ (Z는 표준정규분포, $V$는 자유도 $v$인 카이제곱 분포)
    - 모분산을 모르는 상황에서 표본 평균을 추정/검정할 때 사용됨
        - 주로 `두 집단의 평균이 동일한지` 알고자 할 때 검정통계량으로 활용
    - t-분포는 자유도가 증가할수록 표준정규분포에 수렴 → 주로 30개 이하의 소표본에 사용
    - $X \sim t(k)$ → 확률변수 $X$가 자유도 $k$인 t-분포를 따름
    - `확률밀도함수` : $\frac{\Gamma(\frac{k+1}{2})}{\Gamma(\frac{k}{2})\sqrt{\pi k}}(1+\frac{x^2}{k})^{-\frac{k+1}{2}}, -\infty < x < \infty$
    - `기댓값` : $E(X) = 0$
    - `분산` : $Var(X) = k/(k-2), k>2$

### 2.4 F-분포

---

- `F-분포(F-distribution)` : 두 개의 독립적인 카이제곱-분포를 각각 그 자유도로 나눈 값의 비율로 정의되는 확률분포
    - $F=\frac{V1/k1}{V2/k2} \sim F(k1, k2)$
    - 두 모집단의 모분산 비의 추정/검정과 세집단 이상의 모평균 비교에 사용됨
        - 분산분석(ANOVA)이나 회귀분석에서 모델의 적합도를 평가하는 데 사용
        - 주로 `두 집단간 분산의 동일성 검정`에 활용
    - $X \sim F(m, n)$ → 확률변수 $X$가 자유도 $(m, n)$인 F분포를 따름 → 확률변수 $1/X$은 $F(n, m)$을 따름
    - `확률밀도함수` : $\frac{\Gamma(\frac{m+n}{2})(\frac{m}{n})^{\frac{m}{2}}}{\Gamma(\frac{m}{2})\Gamma(\frac{n}{2})}\frac{x^{\frac{m}{2}-1}}{(1+\frac{m}{n}x)^{\frac{m+n}{2}}}, x>0$
    - `기댓값` : $E(X)=n/(n-2)$
    - `분산` : $Var(X)=\frac{2n^2(m+n-2)}{m(n-2)^2(n-4)}$

## 3. 추정

---

- `확률표본(Random Sample)`
    - 확률분포는 분포를 결정하는 평균, 분산 드의 모수를 가지고 있음
    - 각 관찰값들은 서로 독립적이며 동일한 분포를 가짐(i.i.d)
- 추정이란 표본으로부터 미지의 모수를 추측하는 것을 의미함
    - 추정은 점추정(Point estimation)과 구간추정(Interval estimation)으로 구분

<aside>
✅ **`Check!` i.i.d(independent identically distributed)**

---

- 확률변수나 데이터들이 서로 독립적이며 동일한 확률분포를 따른다는 가정을 나타냄
- Independent(독립적)
    - 각각의 확률변수나 데이터가 다른 것들과 상관 없이 독립적으로 발생한다는 의미
    - 즉, 확률변수나 데이터가 서로에게 영향을 미치지 않는다고 가정
- Identically Distributed(동일한 분포를 따름)
    - 모든 확률변수나 데이터가 동일한 확률분포를 따른다는 의미
    - 데이터들이 동일한 모집단에서 추출되었거나, 같은 확률분포를 가진다고 가정
    

⇒ 가정이 성립하지 않으면 통계적 방법론의 적용이 제한되거나, 결과가 달라질 수 있음

</aside>

### 3.1 점추정

---

- `‘모수가 특정한 값일 것’`이라고 추정하는 것
    - 표본의 평균, 중위수, 최빈값 등을 사용
    - 점추정량의 조건 : 불편성, 효율성, 일치성, 충족성
- 대표적인 점추정
    - 표본평균(Sample Mean) : 모집단의 평균(모평균)을 추정하기 위한 추정량, 확률표본의 평균값
        - $\bar{X}=\frac{1}{n}\sum{X_i}$
    - 표본분산(Sample Variance) : 모집단의 분산(모분산)을 추정하기 위한 추정량
        - $s^2=\frac{1}{n-1}\sum(X_i-\bar{X})^2$
    - 표본비율(Sample Proportion) : 모집단의 비율(모비율)을 추정하기 위한 추정량
        - $\hat{p}=\frac{x}{n}$ ($x$는 표본에서 관심있는 특성을 가진 개체 수 , $n$은 표본이 전체 크기)

<aside>
✅ **`Check!` 불편성, 효율성, 일치성, 충족성**

---

- **불편성(Unbiasedness)**
    - 추정량의 기댓값이 추정하고자 하는 모집단의 모수와 편의(차이)가 없어야 함
- **효율성(Efficiency)**
    - 추정량은 분산이 작을수록 좋음
- **일치성(Consistency)**
    - 표본의 크기가 아주 커지면, 추정량은 모수와 거의 같아짐
- **충족성(Sufficient)**
    - 추정량은 모수에 대하여 모든 정보를 제공함 → 추가적인 정보 없이도 최적의 추적이 가능
</aside>

### 3.2 구간추정

---

![image.png](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%E1%84%83%E1%85%B5%20-%201%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e90dcbbf03944151b1c04bbdf309b603/image%202.png)

- 점추정은 추정값들이 얼마나 정확하게 모수를 추정하고 있는지 알 수 없다는 한계점 존재
- 점추정의 정확성을 보완하기 위해 확률로 표현된 믿음의 정도 하에서 `모수가 특정한 구간에 있을 것이라고 추정`하는 방법
    - 추정량의 분포에 대한 전제가 주어져야 함
    - 구해진 구간 안에 모수가 있을 가능성의 크기(신뢰수준)가 주어져야 함
- 구간추정의 구성 요소
    - `신뢰구간(Confidence Interval)` : 모수가 포함될 것으로 예상되는 범위
        - **신뢰구간 =** **(점추정치 - 임계값 * 표준오차, 점추정치 + 임계값 * 표준오차)**
        - `임계값(Critical Value)` : 신뢰구간의 크기를 결정하는 값으로, 분포에 따라 결정
        - `표준오차(Standard Error)` = $\frac{s}{\sqrt{n}}$ (단, $s$는 표본의 표준편차, $n$은 표본 크기)
        - `허용오차(Margin of Error)` : 추정된 값이 실제 값과 얼마나 떨어져 있는지 보여주는범위 →허용오차 = 임계값 * 표준오차
    - `신뢰수준(Confidence Level)` : 신뢰구간이 모수를 포함할 확률
        - 일반적으로 95%, 99% 등의 신뢰수준이 많이 사용됨 → 신뢰 수준이 높을수록 구간 넓어짐
        - `유의수준(Significance Level)` = 1 - 신뢰수준
- 구간추정의 과정
    1. 점추정치 계산
    2. 표준오차 계산
    3. 신뢰구간 계산

```python
# 일표본 모평균의 추정 (모표준편차를 아는 경우)
import numpy as np
from scipy.stats import norm    # 표준정규분포

x = 31100    # 표본평균
n = 36    # 표본크기
sigma = 4500    # 모표준편차
conf_a = 0.05    # 신뢰수준(confidence level) 95% 기준

SE = sigma / np.sqrt(n)    # 표준오차(standard error)
conf_z = norm.ppf(1 - conf_a / 2)    # 신뢰계수(confidence coefficient)
ME = conf_z * SE    # 오차의 한계 = 허용오차(ME: margin of error)

print("[추정]")
print(f"점 추정량: {x:.3f}")
print(f"구간 추정량: {x - ME:.3f} ~ {x + ME:.3f}")
print(f"오차의 한계: {ME:.3f}")
# [추정]
# 점 추정량: 31100.000
# 구간 추정량: 29630.027 ~ 32569.973
# 오차의 한계: 1469.973

# 오차의 한계에 따른 표본 규모
# (위의 조건에 이어서) 오차의 한계가 500 이하일 확률이 0.95가 되도록 모집단 평균의 추정치를 
# 원하는 경우, 표본 규모는 얼마가 되어야 하는가?
ME = 500
conf_a = 1 - 0.95    # 신뢰수준 95% 기준
conf_z = norm.ppf(conf_a / 2)
ssize = conf_z**2 * sigma**2 / ME**2

print("[표본 규모]")
print(f"유의수준 {conf_a:.2f}에서 오차의 한계를 {ME} 이하로 하려면: 표본 규모 {ssize:.1f} 이상")
# [표본 규모]
# 유의수준 0.05에서 오차의 한계를 500 이하로 하려면: 표본 규모 311.2 이상
```

```python
# 일표본 모평균의 추정 (모표준편차를 모르는 경우)
import numpy as np
from scipy.stats import t    # t분포

x = 650    # 표본평균
n = 16    # 표본크기
s = 55    # 표본표준편차
conf_a = 0.05    # 신뢰수준(confidence level) 95% 기준
df = n-1    # 자유도

SE = s / np.sqrt(n)    # 표준오차(standard error)
conf_t = t.ppf(1 - conf_a / 2, df)    # 신뢰계수(confidence coefficient)
ME = conf_t * SE    # 오차의 한계 = 허용오차(ME: margin of error)

print("[추정]")
print(f"점 추정량: {x:.3f}")
print(f"구간 추정량: {x - ME:.3f} ~ {x + ME:.3f}")
print(f"오차의 한계: {ME:.3f}")
# [추정]
# 점 추정량: 650.000
# 구간 추정량: 620.693 ~ 679.307
# 오차의 한계: 29.307

# 오차의 한계에 따른 표본 규모
# (위의 조건에 이어서) 오차의 한계가 20 이하일 확률이 0.95가 되도록 모집단 평균의 추정치를 
# 원하는 경우, 표본 규모는 얼마가 되어야 하는가?
ME2 = 20
conf_a2 = 1 - 0.95    # 신뢰수준 95% 기준
conf_t2 = t.ppf(conf_a2 / 2, df)
ssize = conf_t2**2 * s**2 / ME2**2

print("[표본 규모]")
print(f"유의수준 {conf_a:.2f}에서 오차의 한계를 {ME} 이하로 하려면: 표본 규모 {ssize:.1f} 이상")
# [표본 규모]
# 유의수준 0.05에서 오차의 한계를 20 이하로 하려면: 표본 규모 34.4 이상
```

## 4. 연습문제

---

### 1번 문제

<aside>
📌

**1번 문제**

---

다음 데이터의 모분산 정보가 없을 때, 다음 데이터의 모평균에 대한 95% 신뢰수준의 신뢰구간을 구하시오. 또한, 다음 데이터의 모표준편차가 3이라는 것을 알고 있을 때, 다음 데이터의 모평균에 대한 95% 신뢰수준의 신뢰구간을 구하시오.

> 10, 19, 15, 11, 13, 14, 18
> 
</aside>

### 문제 풀이

```python
import numpy as np

data = [10, 19, 15, 11, 13, 14, 18]
x = np.mean(data)
s = np.std(data, ddof=1)
n = len(data)
df = n - 1
conf_a = 1 - 0.95

# 모분산을 모르는 경우 => T통계량
from scipy.stats import t

SE = s/np.sqrt(n)    # standard error
conf_t = t.ppf(1 - conf_a/2, df)
ME = conf_t * SE    # margin of error
print(f"신뢰구간: ({round(x - ME, 3)}, {round(x + ME, 3)})")
# 신뢰구간: (11.185, 17.386)

# 모분산을 아는 경우 => Z통계량
from scipy.stats import norm
sigma = 3

SE = sigma/np.sqrt(n)    # standard error
conf_z = norm.ppf(1 - conf_a/2)    # conf_z = 1.96
ME = conf_z * SE    # margin of error
print(f"신뢰구간: ({round(x - ME, 3)}, {round(x + ME, 3)})")
# 신뢰구간: (12.063, 16.508)
```

### 2번 문제

<aside>
📌

**2번 문제**

---

어느 제조회사의 불량률이 5%로 알려져 있다면, 95% 신뢰수준에서 오차의 한계가 3%가 되도록하는 최소 표본 사이즈를 구하시오.

</aside>

### 문제 풀이

```python
# 표본비율에 대한 최소표본규모 문제이다.
# 표본규모 계산 시 모비율 P를 사용하거나 표본비율 p로 계산하거나 두 정보 모두 없다면
# p=0.5로 계산한다. 여기서는 모비율 P를 사용한다.

import math

P = 0.05
ME = 0.03
conf_a = 1 - 0.95

from scipy.stats import norm

conf_z = norm.ppf(1 - conf_a/2)
size = conf_z**2 * P*(1-P) / ME**2    # P*(1-P) -> 표본비율의 표본분산
print(f"최소 표본 사이즈: {math.ceil(size)}")
# 최소 표본 사이즈: 203
```

### 3번 문제

<aside>
📌

**3번 문제**

---

임의로 추출한 표본 30개의 분산을 계산했더니 50일 때, 신뢰도 95%로 모분산의 신뢰구간을 추정하시오. (소수점 둘째자리까지 반올림)

</aside>

### 문제 풀이

```python
# 모평균을 모르는 경우 표본 정보로 모분산의 신뢰구간을 구하는 문제이다.

n = 30
df = n - 1
v = 50
conf_a = 1 - 0.95

from scipy.stats import chi2

conf_c1 = chi2.ppf(1 - conf_a/2, df)
conf_c2 = chi2.ppf(conf_a/2, df)
CR1 = df * v / conf_c1
CR2 = df * v / conf_c2
print(f"신뢰구간: ({round(CR1, 2)}, {round(CR2, 2)})")
# 신뢰구간: (31.71, 90.36)
```

### 4번 문제

<aside>
📌

**4번 문제**

---

어느 뽑기 기계에서 20번 뽑기를 했더니 그 중 5개는 미니카였다. 해당 뽑기 기계에 있는 장난감들 중 미니카의 비율을 P라고 한다면, 모비율 P에 대한 95% 신뢰구간을 구하시오.

</aside>

### 문제 풀이

```python
# 표본비율로 모비율의 신뢰구간을 구하는 문제이다.
import numpy as np

p = 5 / 20
n = 20

from scipy.stats import norm

SE = np.sqrt(p*(1-p)/n)
conf_a = 1 - 0.95
conf_z = norm.ppf(1 - conf_a/2)
ME = conf_z * SE
print(f"신뢰구간: ({round(p - ME, 3)}, {round(p + ME, 3)})")
# 신뢰구간: (0.06, 0.44)
```